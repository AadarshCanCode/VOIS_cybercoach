"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.discoverFiles = discoverFiles;
const fast_glob_1 = __importDefault(require("fast-glob"));
const path_1 = __importDefault(require("path"));
async function discoverFiles(patternOrDir, opts) {
    const isDir = !/[?*]/.test(patternOrDir);
    const base = path_1.default.resolve(patternOrDir);
    const extsPattern = opts.extensions.map(e => e.startsWith('.') ? e.slice(1) : e).join(',');
    // Always ignore node_modules and .git
    const defaultIgnore = ['**/node_modules/**', '**/.git/**', '**/*.d.ts'];
    const userIgnore = opts.ignore.map(i => i.replace(/\\/g, '/'));
    const ignore = [...defaultIgnore, ...userIgnore];
    const globPattern = isDir
        ? `${base.replace(/\\/g, '/')}/**/*.{${extsPattern}}`
        : patternOrDir.replace(/\\/g, '/');
    return (0, fast_glob_1.default)(globPattern, {
        ignore,
        dot: false,
        onlyFiles: true,
        absolute: true
    });
}
